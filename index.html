<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="jquery.timeago.js"></script>
  </head>
  <body>
    <div id="controls">
      <button id="refresh">Refresh</button>
    </div>
    <div id="userBank"></div>
    <div id="newTweets"></div>
    <div id="twittlerBoard"></div>
    <script>

      $(document).ready(function(){
        var $body = $('#twittlerBoard');
        $body.html('');

        jQuery("abbr.timeago").timeago();       

        var tweetTally; //used to store the number of displayed tweets

        var refresh = function(user){
          var index = streams.home.length - 1;
          tweetTally = index;
          while(index >= 0){
            var tweet = streams.home[index];
            var $tweet = $('<div></div>');
            var timeStamp = tweet.created_at;
            if (user === undefined){
              $tweet.text('@' + tweet.user + ': ' + tweet.message+" on "+timeStamp);
              $body.append($tweet);              
            } else {
              if (tweet.user === user){
              $tweet.text(tweet.message+" on "+timeStamp);
              $body.append($tweet);                  
              }
            }
            index -= 1;
          } 
        };

        $("#refresh").on('click',refresh);

        // check for new tweets since index last updated by refresh
        var tweetChecker = function(){ 
          var totalTweets = streams.home.length - 1;
          var newTweets = totalTweets - tweetTally;
          $("#newTweets").text(newTweets + " new tweets!");
        };

        //Automatically show number of new tweets 
        setInterval(tweetChecker, 5000);

        //set up buttons for each user. Each will show it's user's tweets
        for ( var i=0; i<users.length; i++){
          var user = 
          $("<button class='userButton 'id='" +users[i]+"'>"+users[i]+"</button>");
          $("#userBank").append(user);
        }; 

        //reset body to show only tweets of selected user
        $(".userButton").on('click', function(){ 
          var userToList = $(this).attr('id');
          $body.html(userToList + "'s tweets:");
          refresh(userToList);
        });

        refresh();

      });

    </script>
  </body>
</html>
